handling:
  assign: 
    - db-skip-locked
  max_grab: 16
  ready_window_size: 32
runners:
  local:
    load: galaxy.jobs.runners.local:LocalJobRunner
    workers: 4
  slurm:
    load: galaxy.jobs.runners.slurm:SlurmJobRunner
    invalidjobexception_retries: 5
    internalexception_retries: 5
  pulsar_embedded:
    load: galaxy.jobs.runners.pulsar:PulsarEmbeddedJobRunner
    pulsar_config: "{{ galaxy_config_dir }}/pulsar_app.yml"
  pulsar_au_01:
    load: galaxy.jobs.runners.pulsar:PulsarMQJobRunner
    amqp_url: "pyamqp://galaxy_au:{{ vault_rabbitmq_password_galaxy_au_dev }}@dev-queue.usegalaxy.org.au:5671//pulsar/galaxy_au?ssl=1"
    galaxy_url: https://dev.usegalaxy.org.au
    manager: _default_
    amqp_acknowledge: true
    amqp_ack_republish_time: 300
    amqp_consumer_timeout: 2.0
    amqp_publish_retry: true
    amqp_publish_retry_max_retries: 60
  pulsar_nci_test_runner:
    load: galaxy.jobs.runners.pulsar:PulsarMQJobRunner
    amqp_url: "pyamqp://galaxy_nci_test:{{ vault_rabbitmq_password_galaxy_nci_test }}@dev-queue.usegalaxy.org.au:5671//pulsar/galaxy_nci_test?ssl=1"
    galaxy_url: https://dev.usegalaxy.org.au
    manager: _default_
    amqp_acknowledge: true
    amqp_ack_republish_time: 1200
    amqp_consumer_timeout: 2.0
    amqp_publish_retry: true
    amqp_publish_retry_max_retries: 60
  pulsar_eu_gpu:
    load: galaxy.jobs.runners.pulsar:PulsarMQJobRunner
    amqp_url: "pyamqp://galaxy_eu_gpu:{{ vault_rabbitmq_password_galaxy_eu_gpu }}@dev-queue.usegalaxy.org.au:5671//pulsar/galaxy_eu_gpu?ssl=1"
    galaxy_url: "https://dev.usegalaxy.org.au"
    manager: _default_
    amqp_acknowledge: True
    amqp_ack_republish_time: 1200
    amqp_consumer_timeout: 2.0
    amqp_publish_retry: True
    amqp_publish_retry_max_retries: 60
  pulsar_azure_0_runner:
    load: galaxy.jobs.runners.pulsar:PulsarMQJobRunner
    amqp_url: "pyamqp://galaxy_azure_0:{{ vault_rabbitmq_password_galaxy_azure_0 }}@dev-queue.usegalaxy.org.au:5671//pulsar/galaxy_azure_0?ssl=1"
    galaxy_url: "https://dev.usegalaxy.org.au"
    manager: _default_
    amqp_acknowledge: True
    amqp_ack_republish_time: 1200
    amqp_consumer_timeout: 2.0
    amqp_publish_retry: True
    amqp_publish_retry_max_retries: 60
  pulsar_azure_1_runner:
    load: galaxy.jobs.runners.pulsar:PulsarMQJobRunner
    amqp_url: "pyamqp://galaxy_azure_1:{{ vault_rabbitmq_password_galaxy_azure_1 }}@dev-queue.usegalaxy.org.au:5671//pulsar/galaxy_azure_1?ssl=1"
    galaxy_url: "https://dev.usegalaxy.org.au"
    manager: _default_
    amqp_acknowledge: True
    amqp_ack_republish_time: 1200
    amqp_consumer_timeout: 2.0
    amqp_publish_retry: True
    amqp_publish_retry_max_retries: 60
  pulsar_reservation_g2_xlarge_A_runner:
    load: galaxy.jobs.runners.pulsar:PulsarMQJobRunner
    amqp_url: "pyamqp://galaxy_reservation_g2_xlarge_A:{{ vault_rabbitmq_password_galaxy_reservation_g2_xlarge_A }}@dev-queue.usegalaxy.org.au:5671//pulsar/galaxy_reservation_g2_xlarge_A?ssl=1"
    galaxy_url: "https://dev.usegalaxy.org.au"
    manager: _default_
    amqp_acknowledge: True
    amqp_ack_republish_time: 1200
    amqp_consumer_timeout: 2.0
    amqp_publish_retry: True
    amqp_publish_retry_max_retries: 60
  pulsar_reservation_g2_xlarge_B_runner:
    load: galaxy.jobs.runners.pulsar:PulsarMQJobRunner
    amqp_url: "pyamqp://galaxy_reservation_g2_xlarge_B:{{ vault_rabbitmq_password_galaxy_reservation_g2_xlarge_B }}@dev-queue.usegalaxy.org.au:5671//pulsar/galaxy_reservation_g2_xlarge_B?ssl=1"
    galaxy_url: "https://dev.usegalaxy.org.au"
    manager: _default_
    amqp_acknowledge: True
    amqp_ack_republish_time: 1200
    amqp_consumer_timeout: 2.0
    amqp_publish_retry: True
    amqp_publish_retry_max_retries: 60

execution:
  default: tpv_dispatcher
  environments:
    local:
      runner: local
      tags: [registered_user_concurrent_jobs_20]
    tpv_dispatcher:
      runner: dynamic
      type: python
      function: map_tool_to_destination
      rules_module: tpv.rules
      tpv_config_files:
        - https://raw.githubusercontent.com/galaxyproject/tpv-shared-database/main/tools.yml
        - "{{ galaxy_dynamic_job_rules_dir }}/total_perspective_vortex/default_tool.yml"
        - "{{ galaxy_dynamic_job_rules_dir }}/total_perspective_vortex/vortex_config.yml"
        - "{{ galaxy_dynamic_job_rules_dir }}/total_perspective_vortex/destinations.yml"

limits:
- type: anonymous_user_concurrent_jobs
  value: 1
- type: destination_user_concurrent_jobs
  tag: registered_user_concurrent_jobs_20
  value: 20
- type: destination_user_concurrent_jobs
  tag: registered_user_concurrent_jobs_40
  value: 40
